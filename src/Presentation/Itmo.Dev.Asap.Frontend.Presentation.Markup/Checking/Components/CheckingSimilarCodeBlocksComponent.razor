@using Itmo.Dev.Asap.Frontend.Application.Abstractions.Checking.Models

@if (CodeBlocks is not null)
{
    <MudExpansionPanel @bind-IsExpanded="_isExpanded">

        <TitleContent>
            <MudStack Row="true" Justify="Justify.FlexStart" AlignItems="AlignItems.Center">

                <MudText Typo="Typo.h4">
                    @(CodeBlocks.SimilarityScore * 100)%
                </MudText>

                @if (_isExpanded is false)
                {
                    <MudStack Style="flex-basis: 50%">
                        @foreach (var block in CodeBlocks.First)
                        {
                            <MudText Typo="Typo.caption">
                                @block.FilePath
                            </MudText>
                        }
                    </MudStack>

                    <MudStack Style="flex-basis: 50%">
                        @foreach (var block in CodeBlocks.Second)
                        {
                            <MudText Typo="Typo.caption">
                                @block.FilePath
                            </MudText>
                        }
                    </MudStack>
                }

            </MudStack>
        </TitleContent>

        <ChildContent>
            <MudStack Row="true" Justify="Justify.SpaceBetween">

                <MudStack Style="width: 50%">
                    @foreach (var codeBlock in CodeBlocks.First)
                    {
                        <CodeBlockComponent CodeBlock="codeBlock"/>
                    }
                </MudStack>

                <MudStack Style="width: 50%">
                    @foreach (var codeBlock in CodeBlocks.Second)
                    {
                        <CodeBlockComponent CodeBlock="codeBlock"/>
                    }
                </MudStack>

            </MudStack>
        </ChildContent>

    </MudExpansionPanel>
}

@code {

    private bool _isExpanded;

    [Parameter]
    public CheckingSimilarCodeBlocks? CodeBlocks { get; set; }

    private static string ToDisplayString(CheckingCodeBlock codeBlock)
        => $"{codeBlock.FilePath} ({codeBlock.LineFrom}:{codeBlock.LineTo})";

}